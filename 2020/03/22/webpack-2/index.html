<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack-从配置到源码 | 🤯社长の社畜</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="
init package.json
npm init -y（-y是默认都选yes的意思）

scripts
通过npm run build运行构建的原理是：模块局部安装会在./node_modules/.bin目录创建软连接，package.json可以读取到.bin目录下的这些命令。当npm run scripts的时候，会去.bin目录下寻找对应的命令。
// 配置 ...">
    <link rel="preload" href="/assets/css/0.styles.fda92607.css" as="style"><link rel="preload" href="/assets/js/app.7f4b4882.js" as="script"><link rel="preload" href="/assets/js/8.4ab95c53.js" as="script"><link rel="preload" href="/assets/js/3.fadb76cf.js" as="script"><link rel="preload" href="/assets/js/36.66106bb5.js" as="script"><link rel="prefetch" href="/assets/js/10.b2dc55ce.js"><link rel="prefetch" href="/assets/js/11.3a9e0bd4.js"><link rel="prefetch" href="/assets/js/12.7d472947.js"><link rel="prefetch" href="/assets/js/13.aa16d6c6.js"><link rel="prefetch" href="/assets/js/14.37208588.js"><link rel="prefetch" href="/assets/js/15.259fb6c8.js"><link rel="prefetch" href="/assets/js/16.6f1ef36b.js"><link rel="prefetch" href="/assets/js/17.5af21d96.js"><link rel="prefetch" href="/assets/js/18.6b7bd99c.js"><link rel="prefetch" href="/assets/js/19.c826f71e.js"><link rel="prefetch" href="/assets/js/20.d22504b7.js"><link rel="prefetch" href="/assets/js/21.55d5ab5c.js"><link rel="prefetch" href="/assets/js/22.a753f0b7.js"><link rel="prefetch" href="/assets/js/23.699657ef.js"><link rel="prefetch" href="/assets/js/24.b4c49572.js"><link rel="prefetch" href="/assets/js/25.3e4f7af1.js"><link rel="prefetch" href="/assets/js/26.1673bdbd.js"><link rel="prefetch" href="/assets/js/27.f2e3a149.js"><link rel="prefetch" href="/assets/js/28.683f14bc.js"><link rel="prefetch" href="/assets/js/29.e9f41ef1.js"><link rel="prefetch" href="/assets/js/30.1ad33a67.js"><link rel="prefetch" href="/assets/js/31.658218fc.js"><link rel="prefetch" href="/assets/js/32.2894414b.js"><link rel="prefetch" href="/assets/js/33.0ec3aa48.js"><link rel="prefetch" href="/assets/js/34.ed8c5abe.js"><link rel="prefetch" href="/assets/js/35.71e0d56d.js"><link rel="prefetch" href="/assets/js/4.3792b2f6.js"><link rel="prefetch" href="/assets/js/5.57997a9e.js"><link rel="prefetch" href="/assets/js/6.2f06e37f.js"><link rel="prefetch" href="/assets/js/7.dad84601.js"><link rel="prefetch" href="/assets/js/9.929f25d0.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9c3680bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fda92607.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">🤯社长の社畜 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">文章</a></li><li class="nav-item"><a href="/tag/" class="nav-link">标签</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">🤯社长の社畜 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">文章</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">标签</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">社长的社畜</span> <span itemprop="address">   in 北京</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-03-22T00:00:00.000Z">
      Sun Mar 22 2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/Webpack" data-v-42ccfcd5><span data-v-42ccfcd5>Webpack</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="webpack-从配置到源码"><a href="#webpack-从配置到源码" class="header-anchor">#</a> webpack-从配置到源码</h1> <h2 id="init-package-json"><a href="#init-package-json" class="header-anchor">#</a> init package.json</h2> <p>npm init -y（-y是默认都选yes的意思）</p> <h2 id="scripts"><a href="#scripts" class="header-anchor">#</a> scripts</h2> <p>通过npm run build运行构建的原理是：模块局部安装会在./node_modules/.bin目录创建软连接，package.json可以读取到.bin目录下的这些命令。当npm run scripts的时候，会去.bin目录下寻找对应的命令。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 配置：</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>运行<code>npm run build</code>就相当于运行<code>./node_modules/.bin/webpack</code></p> <h2 id="plugins"><a href="#plugins" class="header-anchor">#</a> Plugins</h2> <p>插件用于bundle文件的优化，资源管理（构建之前删除某些指定文件之类的）和环境变量注入。作用于整个构建过程。</p> <h2 id="mode"><a href="#mode" class="header-anchor">#</a> Mode</h2> <p>process.env.NODE_ENV</p> <p>production(default), development, none
设置mode可以使用webpack内置的函数。</p> <h2 id="loader"><a href="#loader" class="header-anchor">#</a> Loader</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/.css$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：loader是链式调用的，执行顺序是从右向左。这里实际执行的时候先执行css-loader，再执行style-loader。</p> <h2 id="file-loader"><a href="#file-loader" class="header-anchor">#</a> file-loader</h2> <p>图片和字体的打包</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(png|jpg|gif|jpeg)$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token string">'file-loader'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(woff|woff2|eot|ttf|otf)$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token string">'file-loader'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>图片打包还可以用url-loader，对于小图片转成base64:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(png|jpg|gif|jpeg)$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      limit<span class="token operator">:</span> <span class="token number">10240</span> <span class="token comment">//字节，10kb</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>小于10kb的图片，打包成base64。减少网络请求。</p> <h2 id="文件监听"><a href="#文件监听" class="header-anchor">#</a> 文件监听</h2> <p>在发现源码发生变化的时候，自动重新构建出新的输出文件。</p> <ul><li>webpack命令，带上--watch</li> <li>在配置webpack.config.js中设置watch: true</li></ul> <h3 id="watch的缺点"><a href="#watch的缺点" class="header-anchor">#</a> watch的缺点:</h3> <ol><li>每次监听到代码变化后会自动重新构建，但是需要手动刷新浏览器。</li> <li>I/O，每次构建完都放到硬盘上，速度慢。</li></ol> <h2 id="热更新-webpack-dev-server-hmr"><a href="#热更新-webpack-dev-server-hmr" class="header-anchor">#</a> 热更新(webpack-dev-server) HMR</h2> <p>配合HotModuleReplacementPlugin，构建后输出的文件直接放在内存里。
package.json, script配置:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --open&quot;</span> <span class="token comment">// --open：构建完成后自动开启浏览器</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack配置：</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="热更新原理："><a href="#热更新原理：" class="header-anchor">#</a> 热更新原理：</h3> <p>这里面的热更新有最核心的是 HMR Server 和 HMR runtime。</p> <p>HMR Server 是服务端，用来将变化的 js 模块通过 websocket 的消息通知给浏览器端。
HMR Runtime是浏览器端，用于接受 HMR Server 传递的模块数据，浏览器端可以看到 .hot-update.json 的文件过来。</p> <p>HotModuleReplacementPlugin是做什么用的？
webpack 构建出来的 bundle.js 本身是不具备热更新的能力的，HotModuleReplacementPlugin 的作用就是将 HMR runtime 注入到 bundle.js，使得bundle.js可以和HMR server建立websocket的通信连接。
￼</p> <h2 id="文件指纹"><a href="#文件指纹" class="header-anchor">#</a> 文件指纹</h2> <p>文件指纹的作用是：版本管理，利用缓存。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// image: hash(md5)</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(png|jpg|gif|jpeg)$/</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'[name]_[hash:8][ext]'</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// js: `[chunkhash]`</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
  path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  filename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'[name]_[chunkhash:8].js'</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// 取八位</span>
<span class="token punctuation">}</span>
<span class="token comment">// css: `[contenthash]`</span>
<span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/\.css$/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// &quot;style-loader&quot;,</span>
    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
      <span class="token string">&quot;css-loader&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// plugins: [</span>
    <span class="token comment">// 把css提取出来形成一个独立的文件</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'[name]_[contenthash:8].css'</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="代码压缩"><a href="#代码压缩" class="header-anchor">#</a> 代码压缩</h2> <p>js文件的压缩：（内置了uglifyjs-webpack-plugin，默认压缩）</p> <p>css文件的压缩：optimize-css-assets-webpack-plugin, cssnano</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		assetsNameRegExp<span class="token operator">:</span> <span class="token regex">/\.css$/g</span><span class="token punctuation">,</span>
		cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>html文件的压缩：html-webpack-plugin, 设置压缩参数。</p> <h2 id="自动清理构建目录"><a href="#自动清理构建目录" class="header-anchor">#</a> 自动清理构建目录</h2> <p>￼clean-webpack-plugin</p> <h2 id="postcss-loader"><a href="#postcss-loader" class="header-anchor">#</a> postcss-loader</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
     loader<span class="token operator">:</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
     options<span class="token operator">:</span> <span class="token punctuation">{</span>
     		<span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
          		<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          			browsers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 version'</span><span class="token punctuation">,</span> <span class="token string">'&gt;1%'</span><span class="token punctuation">,</span> <span class="token string">'ios 7'</span><span class="token punctuation">]</span>
          		<span class="token punctuation">}</span><span class="token punctuation">)</span>
      		<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="移动端rem打包问题"><a href="#移动端rem打包问题" class="header-anchor">#</a> 移动端rem打包问题</h2> <p><a href="https://github.com/amfe/article/issues/17" target="_blank" rel="noopener noreferrer">https://github.com/amfe/article/issues/17<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
￼</p> <h2 id="资源内联"><a href="#资源内联" class="header-anchor">#</a> 资源内联</h2> <p>row-loader, html-inline-css-webpack-plugin</p> <h2 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h2> <p>配置：<code>devtool: 'source-map' (|| 'cheap-source-map')</code></p> <h2 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> splitchunks</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 提取公共文件和react：</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
  splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 最小的体积限制</span>
    cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
      vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/(react|react-dom)/</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'vendors'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      commons<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'commons'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
        minChunks<span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">// 公共资源最少引用的次数</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tree-shaking（摇树优化）"><a href="#tree-shaking（摇树优化）" class="header-anchor">#</a> tree shaking（摇树优化）</h2> <p>tree shaking利用DCE（Dead Code Elimination(淘汰)）来删除没有用的代码。</p> <ul><li>代码不会被执行</li> <li>代码执行的结果不会被用到</li> <li>代码只会影响死变量（只写不读）</li></ul> <p>另外，函数不能有副作用：</p> <p>副作用这个概念来源于函数式编程(FP)，纯函数是没有副作用的，也不依赖外界环境或者改变外界环境。纯函数的概念是：接受相同的输入，任何情况下输出都是一样的。
非纯函数存在副作用，副作用就是：相同的输入，输出不一定相同。或者这个函数会影响到外部变量、外部环境。
函数如果调用了全局对象或者改变函数外部变量，则说明这个函数有副作用。</p> <h2 id="代码分割：动态import，懒加载脚本"><a href="#代码分割：动态import，懒加载脚本" class="header-anchor">#</a> 代码分割：动态import，懒加载脚本</h2> <p>支持动态import需要babel的插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-react&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span> <span class="token comment">// 就是这个</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 动态import：</span>
<span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./text.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        Text<span class="token operator">:</span> Text<span class="token punctuation">.</span>default
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>打包的时候，text.js这个组件会单独build，形如：1_43d42d49.js（打包出来的懒加载脚本）。只有执行loadComponent的时候才会加载该文件。</p> <h2 id="webpack打包library"><a href="#webpack打包library" class="header-anchor">#</a> webpack打包library</h2> <p>这里的例子是一个计算大整数的add函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> a<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">let</span> j <span class="token operator">=</span> b<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">let</span> carry <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> <span class="token operator">+</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      i<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      y <span class="token operator">=</span> <span class="token operator">+</span>b<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
      j<span class="token operator">--</span>
    <span class="token punctuation">}</span> 
    <span class="token comment">// add('99999999999999999999999999999999999', '1')</span>
    sum <span class="token operator">=</span> x <span class="token operator">+</span> y <span class="token operator">+</span> carry
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      carry <span class="token operator">=</span> <span class="token number">1</span>
      sum <span class="token operator">-=</span> <span class="token number">10</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      carry <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
    ret <span class="token operator">=</span> sum <span class="token operator">+</span> ret
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>carry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret <span class="token operator">=</span> carry <span class="token operator">+</span> ret
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js配置：
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 压缩器</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'large-number'</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 完整版</span>
    <span class="token string">'large-number.min'</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 压缩版</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'largeNumber'</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    libraryExport<span class="token operator">:</span> <span class="token string">'default'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token comment">// 如果这里是production的话，上面的两个文件都会被压缩，所以需要下面我们手动设置压缩规则</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//开启压缩工具，mode是production的时候也是true</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        include<span class="token operator">:</span> <span class="token regex">/\.min\.js$/</span>  <span class="token comment">// 只压缩.min.js结尾的文件</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="发布到npm："><a href="#发布到npm：" class="header-anchor">#</a> 发布到npm：</h2> <p>package.json配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;large-number&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;add big number&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// index.js负责判断环境，导出打包好的脚本</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.3.5&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.41.6&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.11&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js，判断环境：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/large-number.min.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dist/large-number.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>发布到npm流程：</p> <ul><li>npm login：登陆npm账号；</li> <li>npm publish：发布到npm。</li></ul> <h2 id="服务端渲染ssr"><a href="#服务端渲染ssr" class="header-anchor">#</a> 服务端渲染SSR</h2> <p>所有模版等资源都存储在服务器，内网机器拉取数据更快，一个HTML返回所有数据。</p> <p>服务端渲染的优势：</p> <ul><li>减少白屏时间</li> <li>对于SEO友好（客户端渲染(SPA)一开始把html拉下来，什么内容都没有，不利于爬虫分析）</li></ul> <p>具体参考<a href="https://ssr.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">vue服务端渲染文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>服务端渲染，不能用import，全部改成CJS语法，用require。注意服务端没有的对象要做特殊处理，例如window，document等等。命名规范可以是，形如：index-server.js。模版渲染具体可以参考vue和react的ssr文档。</p> <p>服务端渲染代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hack处理，服务端没有window等对象</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/search-server'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/search.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span> <span class="token operator">+</span> port<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">server</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span>

<span class="token comment">// 解决样式不显示的问题：</span>
<span class="token comment">// 使⽤用打包出来的浏览器端 html 为模板 </span>
<span class="token comment">// 设置占位符，动态插⼊组件 </span>
<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dataStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;!-- HTML_PLACEHOLDER --&gt;'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;!-- INITIAL_DATA-PLACEHOLDER --&gt;'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;widow.__initial_data=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dataStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>PS：在index.html按照约定用占位符，再把根元素root替换成react renderToString出来的组件字符串。打包出来的search.js是这样的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>search_1fefdefd.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- HTML_PLACEHOLDER --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- INITIAL_DATA-PLACEHOLDER --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>search-server.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="优化构建时命令行的显示日志"><a href="#优化构建时命令行的显示日志" class="header-anchor">#</a> 优化构建时命令行的显示日志</h2> <p>只需设置webpack config:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	entry<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	output<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	stats<span class="token operator">:</span> <span class="token string">'errors-only'</span>
	<span class="token comment">// 如果是dev环境：</span>
	devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    stats<span class="token operator">:</span> <span class="token string">'errors-only'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>效果还是不是很理想，使用优化插件<code>friendly-errors-webpack-plugin</code>。</p> <h2 id="构建包工程化设计"><a href="#构建包工程化设计" class="header-anchor">#</a> 构建包工程化设计</h2> <p>webpack base, dev, prod有些配置是通用的，写在base里面，其他配置文件需要使用webpack merge来合并base选项：https://www.npmjs.com/package/webpack-merge</p> <h2 id="eslint"><a href="#eslint" class="header-anchor">#</a> Eslint</h2> <p>安装：</p> <p><code>npm i eslint babel-eslint eslint-config-airbnb-base eslint-plugin-import -D</code></p> <p>.eslintrc.js配置：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel-eslint&quot;</span><span class="token punctuation">,</span> 
  <span class="token string">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airbnb-base&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">&quot;node&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;parserOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ecmaVersion&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">package</span><span class="token punctuation">.</span>json配置：
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint ./lib --fix&quot;</span> <span class="token comment">// 校验lib文件夹，自动修复空格格式</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="冒烟测试"><a href="#冒烟测试" class="header-anchor">#</a> 冒烟测试</h2> <p>以我们第23点做的webpack构建工程化包为例，我们的冒烟测试主要测试：</p> <ul><li>构建是否成功（webpack构建错误回调）</li> <li>每次构建完成build目录是否有内容输出（测试工具检查：是否有.html, .js, .css等文件）</li></ul> <p>检查./dist文件夹里的生成物：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// css-js-test.js:</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob-all'</span><span class="token punctuation">)</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Checking generated css&amp;js files'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should generate css&amp;js files'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> files <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'./dist/index_*.js'</span><span class="token punctuation">,</span>
      <span class="token string">'./dist/index_*.css'</span><span class="token punctuation">,</span>
      <span class="token string">'./dist/search_*.js'</span><span class="token punctuation">,</span>
      <span class="token string">'./dist/search_*.css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'no css&amp;js files generated'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// index.js:</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rimraf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rimraf'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Mocha <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mocha'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mocha <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mocha</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  timeout<span class="token operator">:</span> <span class="token string">'10000ms'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 进入到当前冒烟测试的template目录</span>

<span class="token comment">// 移除dist目录</span>
<span class="token function">rimraf</span><span class="token punctuation">(</span><span class="token string">'./dist'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prodConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../lib/webpack.prod.js'</span><span class="token punctuation">)</span>

  <span class="token comment">// 删除dist目录之后运行构建</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span>prodConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建是否成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 以错误码2退出</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      colors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Webpack build success, begin run test.'</span><span class="token punctuation">)</span>

    <span class="token comment">// mocha：检查是否有产物</span>
    mocha<span class="token punctuation">.</span><span class="token function">addFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'css-js-test.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    mocha<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="单元测试-测试覆盖率"><a href="#单元测试-测试覆盖率" class="header-anchor">#</a> 单元测试&amp;测试覆盖率</h2> <p>Mocha+chai/assert、Jest（react）</p> <p>测试覆盖率：npm nyc -D</p> <h2 id="持续集成ci"><a href="#持续集成ci" class="header-anchor">#</a> 持续集成CI</h2> <ul><li>https://travis-ci.org/ 使用 GitHub 账号登录</li> <li>在 https://travis-ci.org/account/repositories 为项目开启</li> <li>项目根目录下新增 .travis.yml</li></ul> <h2 id="发布到npm"><a href="#发布到npm" class="header-anchor">#</a> 发布到npm</h2> <p>升级版本，执行命令会自动改变三位的版本数字（eg: v1.0.0）</p> <ul><li>升级补丁版本号: npm version patch (自动变成v1.0.1)</li> <li>升级小版本号: npm version minor (v1.1.0)</li> <li>升级大版本号: npm version major (v2.0.0)</li></ul> <p>发布版本: npm publish</p> <h2 id="commit规范-changlog生成"><a href="#commit规范-changlog生成" class="header-anchor">#</a> Commit规范&amp;Changlog生成</h2> <p>参考angular的 commit规范。
￼
subject：对提交内容的总结描述
body：如果一句话总结不了，就在body里换行列出对提交的代码的描述
footer：可以贴一些链接，比如修复issue的链接</p> <p>本地开发阶段增加 precommit 钩子&amp;自动生成changelog：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install husky <span class="token operator">-</span><span class="token constant">D</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>	<span class="token string">&quot;commitmsg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;validate-commit-msg&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s -r 0&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token string">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token string">&quot;validate-commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.11.1&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;conventional-changelog-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.2.0&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.13.1&quot;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webpack构建速度统计：内置的stats"><a href="#webpack构建速度统计：内置的stats" class="header-anchor">#</a> webpack构建速度统计：内置的stats</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;build:stats&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.prod.js --json &gt; stats.json&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="速度分析：speed-measure-webpack-plugin"><a href="#速度分析：speed-measure-webpack-plugin" class="header-anchor">#</a> 速度分析：speed-measure-webpack-plugin</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	entry<span class="token operator">:</span> <span class="token comment">//,</span>
	output<span class="token operator">:</span> <span class="token comment">//,</span>
	plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>￼</p> <h2 id="体积分析：webpack-bundle-analyzer"><a href="#体积分析：webpack-bundle-analyzer" class="header-anchor">#</a> 体积分析：webpack-bundle-analyzer</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span><span class="token function"> require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 会自动打开http://127.0.0.1:8888/</span>
</code></pre></div><p>备注：几个size的意义？
￼
stats是webpack统计的压缩工具之前的大小，parsed是经过压缩之后的大小。</p> <h2 id="多进程-多实例构建"><a href="#多进程-多实例构建" class="header-anchor">#</a> 多进程/多实例构建</h2> <p>thread-loader</p> <h2 id="并行压缩"><a href="#并行压缩" class="header-anchor">#</a> 并行压缩</h2> <p>terser-webpack-plugin</p> <h2 id="预编译资源模块"><a href="#预编译资源模块" class="header-anchor">#</a> 预编译资源模块</h2> <p>思路:将 react、react-dom、redux、react-redux 基础包和业务基础包打包成一个文件</p> <p>方法:使用 DLLPlugin 进行分包，DllReferencePlugin 对 manifest.json 引用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.dll.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    library<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token string">'react-dom'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash].dll.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build/library'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build/library/[name].json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// webpack.prod.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/library/library.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="缓存提高二次构建速度"><a href="#缓存提高二次构建速度" class="header-anchor">#</a> 缓存提高二次构建速度</h2> <ul><li>babel-loader 开启缓存</li> <li>terser-webpack-plugin 开启缓存</li> <li>使用 cache-loader 或者 hard-source-webpack-plugin</li></ul> <h2 id="减少文件搜索范围"><a href="#减少文件搜索范围" class="header-anchor">#</a> 减少文件搜索范围</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 优化：优化构建路径查找过程</span>
resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  alias<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'react'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react/umd/react.production.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'react-dom'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./node_modules/react-dom/umd/react-dom.production.min.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="体积优化：删除没有用到的css"><a href="#体积优化：删除没有用到的css" class="header-anchor">#</a> 体积优化：删除没有用到的CSS</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">PATHS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  src<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="动态polyfill"><a href="#动态polyfill" class="header-anchor">#</a> 动态polyfill</h2> <p><a href="https://polyfill.io/v3/polyfill.min.js" target="_blank" rel="noopener noreferrer">https://polyfill.io/v3/polyfill.min.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack原理解析"><a href="#webpack原理解析" class="header-anchor">#</a> webpack原理解析</h2> <h3 id="npm-run-dev-build发生了什么？"><a href="#npm-run-dev-build发生了什么？" class="header-anchor">#</a> npm run dev/build发生了什么？</h3> <p>在命令行运行以上命令后，npm会让命令行工具进入<code>node_modules\.bin</code> 目录，查找是否存在 webpack.sh（mac命令）或者 webpack.cmd（windows命令）文件，如果存在，就执行，不存在，就抛出错误。
实际的入口文件是: <code>node_modules\webpack\bin\webpack.js</code> （这里会生成上面的那个命令）</p> <p>启动后的结果：
webpack.js最终找到webpack-cli(或webpack-command)这个npm包，并且执行CLI 。</p> <h3 id="webpack-cli"><a href="#webpack-cli" class="header-anchor">#</a> webpack-cli</h3> <p>webpack-cli 做的事情</p> <ul><li>引入 yargs，对命令行进行定制 分析命令行参数。</li> <li>对各个参数进行转换，组成编译配置项 引用webpack。</li> <li>根据配置项进行编译和构建</li></ul> <p>webpack-cli 提供的不需要编译的命令：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token operator">=</span> <span class="token punctuation">[</span> 
	<span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span> 			<span class="token comment">// 创建一份 webpack 配置文件</span>
	<span class="token string">&quot;migrate&quot;</span><span class="token punctuation">,</span>		<span class="token comment">// 进行 webpack 版本迁移</span>
	<span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span>		      <span class="token comment">// 往 webpack 配置文件中增加属性</span>
	<span class="token string">&quot;remove&quot;</span><span class="token punctuation">,</span> 	      <span class="token comment">// 往 webpack 配置文件中删除属性</span>
	<span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span>	      <span class="token comment">// 运行 webpack-serve	&quot;generate-loader&quot;, 	// 生成 webpack loader 代码</span>
 	<span class="token string">&quot;generate-plugin&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// 生成 webpack plugin 代码 </span>
	<span class="token string">&quot;info&quot;</span>			<span class="token comment">// 返回与本地环境相关的一些信息 </span>
<span class="token punctuation">]</span>
</code></pre></div><p>webpack通过命令行工具包yargs读取命令行参数进行参数分组 (config/config-args.js)，将命令划分为9类:</p> <ul><li>Config options: 配置相关参数(文件名称、运行环境等)</li> <li>Basic options: 基础参数(entry设置、debug模式设置、watch监听设置、devtool设置)</li> <li>Module options: 模块参数，给 loader 设置扩展</li> <li>Output options: 输出参数(输出路径、输出文件名称)</li> <li>Advanced options: 高级用法(记录设置、缓存设置、监听频率、bail等)</li> <li>Resolving options: 解析参数(alias 和 解析的文件后缀设置)</li> <li>Optimizing options: 优化参数</li> <li>Stats options: 统计参数</li> <li>options: 通用参数(帮助命令、版本信息等)</li></ul> <p>webpack-cli 执行的结果：</p> <p>webpack-cli对配置文件和命令行参数进行转换最终生成配置选项参数 options
最终会根据配置参数实例化 webpack 对象，然后执行构建流程</p> <h2 id="webpack的核心：tapable"><a href="#webpack的核心：tapable" class="header-anchor">#</a> webpack的核心：tapable</h2> <p>Webpack 的本质：Webpack可以将其理解是一种基于事件流的编程范例，一系列的插件运行。</p> <p>核心对象 Compiler 继承 Tapable</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span> 
	<span class="token comment">// ... </span>
<span class="token punctuation">}</span> 
</code></pre></div><p>核心对象 Compilation 继承 Tapable</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compilation</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span> 
	<span class="token comment">// ... </span>
<span class="token punctuation">}</span> 
</code></pre></div><p>Tapable 是一个类似于 Node.js 的 EventEmitter 的库，主要是控制钩子函数的发布与订阅,控制着 webpack 的插件系统。</p> <p>Tapable库暴露了很多 Hook(钩子)类，为插件提供挂载的钩子。</p> <p>compiler对象里有一百多个hooks，然后wepack.js会把compiler对象传给每一个plugin，plugin必须实现apply方法，webpack会把compiler对象传递给plugin，通常在plugin内部会用hooks.tap的方式监听compiler里面的钩子，从而在适当的时机执行plugin里面的代码。</p> <p>tapable如何和webpack联系起来？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// node_modules/webpack/lib/webpack.js</span>
<span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiCompiler</span><span class="token punctuation">(</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    infrastructureLogging<span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 遍历options选项中的插件，传入compiler对象</span>
  <span class="token comment">// 这些插件会监听compiler中的hooks，从而在某个时机执行。</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>43.webpack的构建流程-模块构建和chunk生成阶段</p> <p>看源代码流程：</p> <p>make=&gt; addEntry =&gt; _addModuleChain =&gt; buildModule =&gt; module.build(parser) =&gt; seal =&gt; optimization =&gt; createHash =&gt; createModuleAssets(seal done) =&gt; emit
compile.js里面run()触发make钩子，SingleEntryPlugin.js等插件监听了make钩子，然后开始根据entry对模块进行分析，执行compilation中的addEntry()，然后执行buildModule()，buildModule会调用该模块类型对应的build方法(module.build())，然后实际调用例如NormalModule.js里面的doBuild()。在这里对模块的相关require()进行解析，最后把build出来的代码放到compilation的modules对象里。然后触发seal钩子，这里主要进行一些优化，optimization。</p> <p>Chunk 生成算法 ：</p> <ul><li>webpack 先将 entry 中对应的 module 都生成一个新的 chunk</li> <li>遍历 module 的依赖列表，将依赖的 module 也加入到 chunk 中</li> <li>如果一个依赖 module 是动态引入的模块，那么就会根据这个 module 创建一个 新的 chunk，继续遍历依赖</li> <li>重复上面的过程，直至得到所有的 chunks</li></ul> <h2 id="webpack的构建流程-文件生成"><a href="#webpack的构建流程-文件生成" class="header-anchor">#</a> webpack的构建流程-文件生成</h2> <p>emit钩子，compliation.assets输出到磁盘目录.</p> <h2 id="loader（开发loader官网有教程）"><a href="#loader（开发loader官网有教程）" class="header-anchor">#</a> loader（开发loader官网有教程）</h2> <p>loader的执行顺序是从右到左。（compose函数，函数式）</p> <p>loader-runner：loader-runner 允许你在不安装 webpack 的情 况下运行 loaders。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 代码示例</span>
<span class="token comment">// node run-loader.js</span>
<span class="token comment">// run-loader.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-runner'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resource<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/demo.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/raw-loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token comment">// loader的参数，可以通过loader-util的getOptions方法来获取此参数</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'test'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  readResource<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  err <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// raw-loader.js</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取传递给loader的参数</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>

  <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/u2028/g</span><span class="token punctuation">,</span> <span class="token string">'\\u2028'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/u2029/g</span><span class="token punctuation">,</span> <span class="token string">'\\u2029'</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 异步loader：</span>
<span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./async.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>loader输出内容到文件：this.emitFile(url, source)</p> <h2 id="开发plugin（官网有教程）"><a href="#开发plugin（官网有教程）" class="header-anchor">#</a> 开发plugin（官网有教程）</h2> <p>传参：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'aaa'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
<span class="token comment">// my-plugin.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 参数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'My plugin is excuted!'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'My plugin options'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#init-package-json" title="init package.json">init package.json</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#scripts" title="scripts">scripts</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#plugins" title="Plugins">Plugins</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#mode" title="Mode">Mode</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#loader" title="Loader">Loader</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#file-loader" title="file-loader">file-loader</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#文件监听" title="文件监听">文件监听</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#watch的缺点" title="watch的缺点:">watch的缺点:</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#热更新-webpack-dev-server-hmr" title="热更新(webpack-dev-server) HMR">热更新(webpack-dev-server) HMR</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#热更新原理：" title="热更新原理：">热更新原理：</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#文件指纹" title="文件指纹">文件指纹</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#代码压缩" title="代码压缩">代码压缩</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#自动清理构建目录" title="自动清理构建目录">自动清理构建目录</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#postcss-loader" title="postcss-loader">postcss-loader</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#移动端rem打包问题" title="移动端rem打包问题">移动端rem打包问题</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#资源内联" title="资源内联">资源内联</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#source-map" title="source-map">source-map</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#splitchunks" title="splitchunks">splitchunks</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#tree-shaking（摇树优化）" title="tree shaking（摇树优化）">tree shaking（摇树优化）</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#代码分割：动态import，懒加载脚本" title="代码分割：动态import，懒加载脚本">代码分割：动态import，懒加载脚本</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#webpack打包library" title="webpack打包library">webpack打包library</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#发布到npm：" title="发布到npm：">发布到npm：</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#服务端渲染ssr" title="服务端渲染SSR">服务端渲染SSR</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#优化构建时命令行的显示日志" title="优化构建时命令行的显示日志">优化构建时命令行的显示日志</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#构建包工程化设计" title="构建包工程化设计">构建包工程化设计</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#eslint" title="Eslint">Eslint</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#冒烟测试" title="冒烟测试">冒烟测试</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#单元测试-测试覆盖率" title="单元测试&amp;测试覆盖率">单元测试&amp;测试覆盖率</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#持续集成ci" title="持续集成CI">持续集成CI</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#发布到npm" title="发布到npm">发布到npm</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#commit规范-changlog生成" title="Commit规范&amp;Changlog生成">Commit规范&amp;Changlog生成</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#webpack构建速度统计：内置的stats" title="webpack构建速度统计：内置的stats">webpack构建速度统计：内置的stats</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#速度分析：speed-measure-webpack-plugin" title="速度分析：speed-measure-webpack-plugin">速度分析：speed-measure-webpack-plugin</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#体积分析：webpack-bundle-analyzer" title="体积分析：webpack-bundle-analyzer">体积分析：webpack-bundle-analyzer</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#多进程-多实例构建" title="多进程/多实例构建">多进程/多实例构建</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#并行压缩" title="并行压缩">并行压缩</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#预编译资源模块" title="预编译资源模块">预编译资源模块</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#缓存提高二次构建速度" title="缓存提高二次构建速度">缓存提高二次构建速度</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#减少文件搜索范围" title="减少文件搜索范围">减少文件搜索范围</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#体积优化：删除没有用到的css" title="体积优化：删除没有用到的CSS">体积优化：删除没有用到的CSS</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#动态polyfill" title="动态polyfill">动态polyfill</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#webpack原理解析" title="webpack原理解析">webpack原理解析</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#npm-run-dev-build发生了什么？" title="npm run dev/build发生了什么？">npm run dev/build发生了什么？</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#webpack-cli" title="webpack-cli">webpack-cli</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#webpack的核心：tapable" title="webpack的核心：tapable">webpack的核心：tapable</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#webpack的构建流程-文件生成" title="webpack的构建流程-文件生成">webpack的构建流程-文件生成</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#loader（开发loader官网有教程）" title="loader（开发loader官网有教程）">loader（开发loader官网有教程）</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#开发plugin（官网有教程）" title="开发plugin（官网有教程）">开发plugin（官网有教程）</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="mailto: ischenkan@outlook.com" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-fdbf4940><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-fdbf4940></path><polyline points="22,6 12,13 2,6" data-v-fdbf4940></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="https://kuifafa.com" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940>Create by 🐱社长的社畜</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7f4b4882.js" defer></script><script src="/assets/js/8.4ab95c53.js" defer></script><script src="/assets/js/3.fadb76cf.js" defer></script><script src="/assets/js/36.66106bb5.js" defer></script>
  </body>
</html>
