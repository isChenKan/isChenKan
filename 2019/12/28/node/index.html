<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.jséƒ¨åˆ†çŸ¥è¯†ç‚¹æ¦‚è§ˆ | ğŸ¤¯ç¤¾é•¿ã®ç¤¾ç•œ</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="
nodeç¯å¢ƒå˜é‡
__filename //å½“å‰æ–‡ä»¶ä½ç½®

__dirname //å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•ä½ç½®

processè¿›ç¨‹å¯¹è±¡ï¼š
platform,
cpuUsage,
memoryUsage.

env //è¿è¡Œç¯å¢ƒå˜é‡

argv //å¯åŠ¨nodeçš„å‘½ä»¤è¡Œ

nodeè§‚å¯Ÿè€…ï¼š
// lib.js
const EventEmitter = require('eve ...">
    <link rel="preload" href="/assets/css/0.styles.fda92607.css" as="style"><link rel="preload" href="/assets/js/app.7f4b4882.js" as="script"><link rel="preload" href="/assets/js/8.4ab95c53.js" as="script"><link rel="preload" href="/assets/js/3.fadb76cf.js" as="script"><link rel="preload" href="/assets/js/13.aa16d6c6.js" as="script"><link rel="prefetch" href="/assets/js/10.b2dc55ce.js"><link rel="prefetch" href="/assets/js/11.3a9e0bd4.js"><link rel="prefetch" href="/assets/js/12.7d472947.js"><link rel="prefetch" href="/assets/js/14.37208588.js"><link rel="prefetch" href="/assets/js/15.259fb6c8.js"><link rel="prefetch" href="/assets/js/16.6f1ef36b.js"><link rel="prefetch" href="/assets/js/17.5af21d96.js"><link rel="prefetch" href="/assets/js/18.6b7bd99c.js"><link rel="prefetch" href="/assets/js/19.c826f71e.js"><link rel="prefetch" href="/assets/js/20.d22504b7.js"><link rel="prefetch" href="/assets/js/21.55d5ab5c.js"><link rel="prefetch" href="/assets/js/22.a753f0b7.js"><link rel="prefetch" href="/assets/js/23.699657ef.js"><link rel="prefetch" href="/assets/js/24.b4c49572.js"><link rel="prefetch" href="/assets/js/25.3e4f7af1.js"><link rel="prefetch" href="/assets/js/26.1673bdbd.js"><link rel="prefetch" href="/assets/js/27.f2e3a149.js"><link rel="prefetch" href="/assets/js/28.683f14bc.js"><link rel="prefetch" href="/assets/js/29.e9f41ef1.js"><link rel="prefetch" href="/assets/js/30.1ad33a67.js"><link rel="prefetch" href="/assets/js/31.658218fc.js"><link rel="prefetch" href="/assets/js/32.2894414b.js"><link rel="prefetch" href="/assets/js/33.0ec3aa48.js"><link rel="prefetch" href="/assets/js/34.ed8c5abe.js"><link rel="prefetch" href="/assets/js/35.71e0d56d.js"><link rel="prefetch" href="/assets/js/36.66106bb5.js"><link rel="prefetch" href="/assets/js/4.3792b2f6.js"><link rel="prefetch" href="/assets/js/5.57997a9e.js"><link rel="prefetch" href="/assets/js/6.2f06e37f.js"><link rel="prefetch" href="/assets/js/7.dad84601.js"><link rel="prefetch" href="/assets/js/9.929f25d0.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.9c3680bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fda92607.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">ğŸ¤¯ç¤¾é•¿ã®ç¤¾ç•œ </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">æ–‡ç« </a></li><li class="nav-item"><a href="/tag/" class="nav-link">æ ‡ç­¾</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">ğŸ¤¯ç¤¾é•¿ã®ç¤¾ç•œ </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">æ–‡ç« </a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">æ ‡ç­¾</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">ç¤¾é•¿çš„ç¤¾ç•œ</span> <span itemprop="address"> Â  in åŒ—äº¬</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2019-12-28T00:00:00.000Z">
      Sat Dec 28 2019
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/Node.js" data-v-42ccfcd5><span data-v-42ccfcd5>Node.js</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="node-jséƒ¨åˆ†çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#node-jséƒ¨åˆ†çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="header-anchor">#</a> Node.jséƒ¨åˆ†çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1> <h2 id="nodeç¯å¢ƒå˜é‡"><a href="#nodeç¯å¢ƒå˜é‡" class="header-anchor">#</a> nodeç¯å¢ƒå˜é‡</h2> <p>__filename //å½“å‰æ–‡ä»¶ä½ç½®</p> <p>__dirname //å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•ä½ç½®</p> <p>processè¿›ç¨‹å¯¹è±¡ï¼š
platform,
cpuUsage,
memoryUsage.</p> <p>env //è¿è¡Œç¯å¢ƒå˜é‡</p> <p>argv //å¯åŠ¨nodeçš„å‘½ä»¤è¡Œ</p> <h2 id="nodeè§‚å¯Ÿè€…ï¼š"><a href="#nodeè§‚å¯Ÿè€…ï¼š" class="header-anchor">#</a> nodeè§‚å¯Ÿè€…ï¼š</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// lib.js</span>
<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>EventEmitter

<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// æŠ›å‡ºäº‹ä»¶</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'new'</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> a

<span class="token comment">// index.js</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib'</span><span class="token punctuation">)</span>
<span class="token comment">// ç›‘å¬äº‹ä»¶</span>
a<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'new'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>è§‚å¯Ÿè€…æ¨¡å¼é€‚åˆä¸çŸ¥é“è¢«é€šçŸ¥è€…çš„å­˜åœ¨ï¼Œä»¥åŠæ²¡æœ‰äººå¬ç¨‹åºè¿˜èƒ½ç»§ç»­ä¸‹å»å°±ç®—æ²¡æœ‰æ¥æ”¶ä¹Ÿå¯ä»¥ç»§ç»­ä¸‹å»çš„æƒ…å†µï¼Œæ¯”å¦‚è¯´ä¸Šæ–°ä¹‹åç»™ç”¨æˆ·ç¾¤å‘é€šçŸ¥ã€‚å¤šæ¨¡å—å¼•ç”¨ï¼Œæ‰©å±•æ€§å¼ºã€‚</p> <h2 id="nodeéé˜»å¡i-o"><a href="#nodeéé˜»å¡i-o" class="header-anchor">#</a> nodeéé˜»å¡I/O</h2> <p>I/Oï¼šinput/output</p> <p>é˜»å¡I/Oå’Œéé˜»å¡I/Oçš„åŒºåˆ«å°±æ˜¯ç³»ç»Ÿæ¥æ”¶è¾“å…¥åˆ°è¾“å‡ºçš„æœŸé—´ï¼Œè¿˜èƒ½ä¸èƒ½æ¥æ”¶å…¶ä»–çš„è¾“å…¥ï¼Œé˜»å¡çš„I/Oå°±æ˜¯ä¸å¯ä»¥çš„ã€‚</p> <p>ä¾‹å­ï¼šæ’é˜Ÿæ‰“é¥­</p> <p>å¯¹äºç‚¹èœäººå‘˜ï¼ˆå•ä¸€å¯¹è±¡æ€è€ƒé˜»å¡é—®é¢˜ï¼‰ï¼š</p> <p>æ’é˜Ÿæ‰“é¥­----é˜»å¡I/O</p> <p>é¤å…ç‚¹èœ----éé˜»å¡I/O</p> <p>globï¼šéé˜»å¡çš„ä¾‹å­</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>
<span class="token function">glob</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/**/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>
<span class="token comment">// glob: 2ms</span>
</code></pre></div><h2 id="æ´‹è‘±æ¨¡å‹"><a href="#æ´‹è‘±æ¨¡å‹" class="header-anchor">#</a> æ´‹è‘±æ¨¡å‹</h2> <p>expressçš„æ´‹è‘±æ¨¡å‹å­˜åœ¨å¼‚æ­¥ç¼ºé™·ï¼Œkoaç”¨promiseï¼Œasyncï¼Œawaitè§£å†³äº†æ­¤é—®é¢˜ã€‚
å¼•ç”¨ä¸¤å¼ <a href="https://eggjs.org/zh-cn/intro/egg-and-koa.html" target="_blank" rel="noopener noreferrer">Egg.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>å®˜ç½‘çš„å›¾ç‰‡ï¼š</p> <p><img src="/assets/img/yangcong.2972bdca.png" alt="An image"></p> <p><img src="/assets/img/middleware.5fabc0c7.gif" alt="An image"></p> <h2 id="rpcè°ƒç”¨"><a href="#rpcè°ƒç”¨" class="header-anchor">#</a> RPCè°ƒç”¨</h2> <p>å’Œajaxçš„ä¸åŒï¼š</p> <ul><li>ajaxæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼ŒRPCæ˜¯æœåŠ¡å™¨å’Œå¦ä¸€å°æœåŠ¡å™¨ã€‚ï¼ˆæ›´å¿«ï¼‰</li> <li>ä¸ä¸€å®šä½¿ç”¨DNSä½œä¸ºå¯»å€æœåŠ¡ã€‚</li> <li>åº”ç”¨å±‚åè®®ä¸€èˆ¬ä¸ä½¿ç”¨HTTPã€‚</li> <li>åŸºäºTCPæˆ–UDPã€‚</li></ul> <h2 id="tcpé€šä¿¡æ–¹å¼ï¼š"><a href="#tcpé€šä¿¡æ–¹å¼ï¼š" class="header-anchor">#</a> TCPé€šä¿¡æ–¹å¼ï¼š</h2> <ul><li>å•å·¥é€šä¿¡</li> <li>åŠåŒå·¥é€šä¿¡ï¼ˆhttp1.1ï¼‰</li> <li>å…¨åŒå·¥é€šä¿¡ï¼ˆéš¾åº¦æˆæœ¬å¤§,http2ï¼‰</li></ul> <p>RPCè°ƒç”¨æ˜¯æœåŠ¡å™¨è·ŸæœåŠ¡å™¨çš„é€šä¿¡ï¼Œä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œæ›´å°çš„æ•°æ®åŒ…ä½“ç§¯ï¼Œæ›´å¿«çš„ç¼–ç é€Ÿç‡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// protocol buffers:</span>

<span class="token comment">// npm i protocol buffers</span>
<span class="token keyword">const</span> buffer1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> buffer2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> buffer3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> 

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">)</span>

buffer2<span class="token punctuation">.</span><span class="token function">writeInt8</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> protobuf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'protocol-buffers'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token function">protobuf</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/test.proto'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> schema<span class="token punctuation">.</span>Column<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  price<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>Column<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="netï¼šå¤šè·¯å¤ç”¨çš„rpcé€šé“"><a href="#netï¼šå¤šè·¯å¤ç”¨çš„rpcé€šé“" class="header-anchor">#</a> netï¼šå¤šè·¯å¤ç”¨çš„RPCé€šé“</h2> <p>åŠåŒå·¥é€šä¿¡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//server.js</span>
<span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readInt32BE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token string">'c'</span>
<span class="token punctuation">}</span>

<span class="token comment">//client.js</span>
<span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">net<span class="token punctuation">.</span>Socket</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">4000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span>

<span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
buffer<span class="token punctuation">.</span><span class="token function">writeInt32BE</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  buffer<span class="token punctuation">.</span><span class="token function">writeInt32BE</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="å…¨åŒå·¥é€šä¿¡"><a href="#å…¨åŒå·¥é€šä¿¡" class="header-anchor">#</a> å…¨åŒå·¥é€šä¿¡</h2> <p>å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯éƒ½å¯ä»¥éšæ—¶äº’ç›¸å‘é€ä¿¡æ¯ï¼Œæ€ä¹ˆæ¥åˆ†æ¸…æ¥šä¸€ä¸ªè¿”å›åŒ…å¯¹åº”çš„æ˜¯å“ªä¸ªè¯·æ±‚åŒ…å‘¢ï¼Ÿ
ç­”æ¡ˆå°±æ˜¯ç”¨ä¸€ä¸ªseqæ¥æ ‡è®°è¯·æ±‚åŒ…ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//server.js</span>
<span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> seqBuffer <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readInt32BE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment">// è¿”å›çš„åŒ…æ˜¯éšæœºæ—¶é—´çš„ï¼Œä¸åƒä¸Šä¸€ä¸ªä¾‹å­æ˜¯ç­‰å¾…è¿”å›æ‰å‘ä¸‹ä¸€ä¸ªåŒ…</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        seqBuffer<span class="token punctuation">,</span>
        Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
      socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3000</span> <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">'111'</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token string">'222'</span><span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token operator">:</span> <span class="token string">'333'</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token operator">:</span> <span class="token string">'444'</span><span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token operator">:</span> <span class="token string">'555'</span><span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token operator">:</span> <span class="token string">'666'</span>
<span class="token punctuation">}</span>

<span class="token comment">//client.js</span>
<span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">net<span class="token punctuation">.</span>Socket</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
socket<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">4000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">]</span>

socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> seqBuffer <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> titleBuffer <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>seqBuffer<span class="token punctuation">.</span><span class="token function">readInt16BE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> titleBuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'===================='</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> seq <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">function</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> buffer <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> id <span class="token operator">=</span> data<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span>
  buffer<span class="token punctuation">.</span><span class="token function">writeInt16BE</span><span class="token punctuation">(</span>seq<span class="token punctuation">)</span>
  buffer<span class="token punctuation">.</span><span class="token function">writeInt32BE</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>seq<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
  seq<span class="token operator">++</span>
  <span class="token keyword">return</span> buffer
<span class="token punctuation">}</span>
<span class="token comment">// ä¸ç”¨ç­‰å¾…è¿”å›ï¼Œä¸æ–­çš„å‘è¯·æ±‚ã€‚é€šè¿‡seqæ¥æ‰¾åˆ°å¯¹åº”çš„è¿”å›åŒ…ã€‚</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ç²˜åŒ…"><a href="#ç²˜åŒ…" class="header-anchor">#</a> ç²˜åŒ…</h2> <p>å…¨åŒå·¥é€šä¿¡çš„é—®é¢˜ï¼Œä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>TCPåè®®ä¼šæŠŠå®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå¤§åŒ…ã€‚ç§°ä¹‹ä¸ºç²˜åŒ…ã€‚è¦åœ¨serveré‡Œé¢è¿›è¡Œç²˜åŒ…åˆ‡åˆ†ã€‚æŠŠè¿™äº›è¯·æ±‚è¿˜åŸæˆåŸå§‹çš„åŒ…ã€‚
ï¿¼</p> <h2 id="ç”¨es6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“"><a href="#ç”¨es6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“" class="header-anchor">#</a> ç”¨ES6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“</h2> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">runInNewContext</span><span class="token punctuation">(</span>ï¼‰
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'a'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">runInNewContext</span><span class="token punctuation">(</span><span class="token string">'`&lt;h2&gt;${user.name}&lt;/h2&gt;`'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &lt;h2&gt;a&lt;/h2&gt;</span>
</code></pre></div><p>æŠŠes6å½“ejsæ¨¡ç‰ˆå¼•æ“ç”¨ï¼šæŠŠæ¨¡ç‰ˆå­—ç¬¦ä¸²æ”¾è¿›æ²™ç®±é‡Œé¢ï¼Œä¼ æ•°æ®è¿›å»é‡æ–°ç¼–è¯‘è¿è¡Œã€‚</p> <h2 id="xssè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ"><a href="#xssè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ" class="header-anchor">#</a> XSSè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> templateMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  templateA<span class="token operator">:</span> <span class="token string">'`&lt;h1&gt;${include(&quot;templateB&quot;, {name: &quot;chenkan&quot;})}&lt;h2&gt;${data.age}&lt;/h2&gt;&lt;/h1&gt;`'</span><span class="token punctuation">,</span>
  templateB<span class="token operator">:</span> <span class="token string">'`&lt;p&gt;${data.name}&lt;/p&gt;`'</span>
<span class="token punctuation">}</span>
<span class="token comment">//includeå­æ¨¡ç‰ˆ</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">include</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> templateMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//XSSè¿‡æ»¤</span>
  <span class="token function-variable function">_</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>markup<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>markup<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&amp;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&gt;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/'/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;#39;'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&quot;/g</span><span class="token punctuation">,</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>templateMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> temp <span class="token operator">=</span> templateMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  templateMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInNewContext</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    (function (data) {
	//withä¼ å‚æ•°
      with (data) {
        return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>temp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      }
    })
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>templateMap<span class="token punctuation">[</span><span class="token string">'templateA'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &lt;h1&gt;&lt;p&gt;chenkan&lt;/p&gt;&lt;h2&gt;24&lt;/h2&gt;&lt;/h1&gt;</span>
</code></pre></div><h2 id="easysockï¼ˆrpcé€šä¿¡ï¼‰"><a href="#easysockï¼ˆrpcé€šä¿¡ï¼‰" class="header-anchor">#</a> EasySockï¼ˆrpcé€šä¿¡ï¼‰</h2> <p><a href="https://www.npmjs.com/package/easy_sock" target="_blank" rel="noopener noreferrer">EasySockï¼ˆrpcé€šä¿¡ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> easySock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EasySock</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    ip<span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">4000</span><span class="token punctuation">,</span>
    timeout<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    <span class="token comment">// å…¨åŒå·¥é€šä¿¡</span>
    keepAlive<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="httpæ€§èƒ½åˆ†æ"><a href="#httpæ€§èƒ½åˆ†æ" class="header-anchor">#</a> HTTPæ€§èƒ½åˆ†æ</h2> <h3 id="abå‹æµ‹"><a href="#abå‹æµ‹" class="header-anchor">#</a> abå‹æµ‹</h3> <p>ab -c200 -n1500 http://127.0.0.1:3000/download/</p> <p>-c200è¡¨ç¤ºåŒæ—¶æœ‰200ä¸ªè¯·æ±‚ï¼Œ-n1500è¡¨ç¤ºè¯·æ±‚1500æ¬¡ã€‚ï¼ˆps: -t15è¡¨ç¤ºè¯·æ±‚15sï¼‰</p> <h2 id="nodejsè°ƒè¯•"><a href="#nodejsè°ƒè¯•" class="header-anchor">#</a> Nodejsè°ƒè¯•</h2> <h3 id="node-profile"><a href="#node-profile" class="header-anchor">#</a> node profile</h3> <ol><li>å…ˆæ‰§è¡Œï¼š
node --prof index.js
å¯åŠ¨ã€‚</li> <li>ç„¶åè¿›è¡Œå‹æµ‹ï¼Œç”Ÿæˆä¸€ä¸ªlogæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œï¼š
node --prof-process isolate-0x103800000-v8.log &gt; profile.txt
å¾—åˆ°profile.txtï¼ŒåŒ…å«äº†æ€§èƒ½ç»“æœã€‚
ä¸»è¦æ‹‰åˆ°æœ€åçœ‹[Bottom up (heavy) profile]</li></ol> <h3 id="chrome-devtools"><a href="#chrome-devtools" class="header-anchor">#</a> chrome devtools</h3> <ol><li>node --inspect-brk index.js</li> <li>chromeåœ°å€æ è¾“å…¥chrome://inspect</li> <li>profile startç›‘å¬</li> <li>abå‹æµ‹</li> <li>chromeä¼šç”Ÿæˆprofilerå¯è§†åŒ–åˆ†ææŠ¥å‘Š</li></ol> <h2 id="cluster"><a href="#cluster" class="header-anchor">#</a> cluster</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cluster <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cluster'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isMaster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./index.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>clusterå¯ä»¥forkå¤šä¸ªå­è¿›ç¨‹ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPUã€‚ä½†æ˜¯ä¸ç¨³å®šã€‚</p> <p>nodejsç›‘å¬å†…å­˜ï¼šprocess.memoryUsage().rss</p> <h2 id="serverless"><a href="#serverless" class="header-anchor">#</a> serverless</h2> <p>å±è”½æœåŠ¡å™¨ç»†èŠ‚ï¼Œç›´æ¥å†™å‡½æ•°å°±å¯ä»¥å®ŒæˆæœåŠ¡ç«¯åŠŸèƒ½çš„å¼€å‘ï¼Œä½¿ç”¨è€…ä¸ç”¨å…³æ³¨è¿ç»´å’ŒæœåŠ¡å™¨çš„ç»†èŠ‚ã€‚è·Ÿvueå’Œreactå±è”½äº†domæ“ä½œçš„ç»†èŠ‚ä¸€æ ·ã€‚lesså°±æ˜¯å±è”½ç»†èŠ‚ï¼ˆæŠŠå¤šä¸ªä¸šåŠ¡å¤ç”¨çš„ä¸œè¥¿ä¸‹æ²‰ï¼‰ï¼Œè®©ä¸šåŠ¡å¼€å‘æ›´å®¹æ˜“ï¼Œæ›´ç¨³å®šã€‚</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#nodeç¯å¢ƒå˜é‡" title="nodeç¯å¢ƒå˜é‡">nodeç¯å¢ƒå˜é‡</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#nodeè§‚å¯Ÿè€…ï¼š" title="nodeè§‚å¯Ÿè€…ï¼š">nodeè§‚å¯Ÿè€…ï¼š</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#nodeéé˜»å¡i-o" title="nodeéé˜»å¡I/O">nodeéé˜»å¡I/O</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#æ´‹è‘±æ¨¡å‹" title="æ´‹è‘±æ¨¡å‹">æ´‹è‘±æ¨¡å‹</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#rpcè°ƒç”¨" title="RPCè°ƒç”¨">RPCè°ƒç”¨</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#tcpé€šä¿¡æ–¹å¼ï¼š" title="TCPé€šä¿¡æ–¹å¼ï¼š">TCPé€šä¿¡æ–¹å¼ï¼š</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#netï¼šå¤šè·¯å¤ç”¨çš„rpcé€šé“" title="netï¼šå¤šè·¯å¤ç”¨çš„RPCé€šé“">netï¼šå¤šè·¯å¤ç”¨çš„RPCé€šé“</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#å…¨åŒå·¥é€šä¿¡" title="å…¨åŒå·¥é€šä¿¡">å…¨åŒå·¥é€šä¿¡</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#ç²˜åŒ…" title="ç²˜åŒ…">ç²˜åŒ…</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#ç”¨es6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“" title="ç”¨ES6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“">ç”¨ES6å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡ç‰ˆå¼•æ“</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#xssè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ" title="XSSè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ">XSSè¿‡æ»¤å’Œincludeå­æ¨¡ç‰ˆ</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#easysockï¼ˆrpcé€šä¿¡ï¼‰" title="EasySockï¼ˆrpcé€šä¿¡ï¼‰">EasySockï¼ˆrpcé€šä¿¡ï¼‰</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#httpæ€§èƒ½åˆ†æ" title="HTTPæ€§èƒ½åˆ†æ">HTTPæ€§èƒ½åˆ†æ</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#abå‹æµ‹" title="abå‹æµ‹">abå‹æµ‹</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#nodejsè°ƒè¯•" title="Nodejsè°ƒè¯•">Nodejsè°ƒè¯•</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#node-profile" title="node profile">node profile</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#chrome-devtools" title="chrome devtools">chrome devtools</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#cluster" title="cluster">cluster</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#serverless" title="serverless">serverless</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="mailto: ischenkan@outlook.com" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-fdbf4940><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-fdbf4940></path><polyline points="22,6 12,13 2,6" data-v-fdbf4940></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="https://kuifafa.com" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940>Create by ğŸ±ç¤¾é•¿çš„ç¤¾ç•œ</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7f4b4882.js" defer></script><script src="/assets/js/8.4ab95c53.js" defer></script><script src="/assets/js/3.fadb76cf.js" defer></script><script src="/assets/js/13.aa16d6c6.js" defer></script>
  </body>
</html>
